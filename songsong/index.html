<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>送送专属首页</title>
    <link href="https://fonts.googleapis.com/css?family=Patrick+Hand" rel="stylesheet">
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous">
    </script>

    <style>
      #clock-row {
        position:absolute;
        bottom:0;
        width:100%
      }
      #clock-text {
        color: #EEE;
        font-size:10vmin;
        text-align: center;
      }
      #bg {
          height: 100%;
          background-position: center;
          background-repeat: no-repeat;
          background-size: cover;
      }
      body, html {
        height: 100%;
        margin: 0;
        font-family: 'Patrick Hand', cursive;
      }
    </style>
    <script type="text/javascript">
      //This is my simple version of Google Analytics, tracking your IP address anonymously.
      var pre_filled_google_form_url = "https://docs.google.com/forms/d/14JwaHBvJEGQHVHE6MDBifPwDuhK0Nu1qxjR1eHn9oOU/viewform?entry.1210918600=trackID&entry.1145607281=ip&entry.833940562=hostname&entry.1616940506=city&entry.768400234=region&entry.626288021=country&entry.916117704=loc&entry.1292697802=org&entry.2103705445=postal";
      twohalf = pre_filled_google_form_url.split('viewform?');
      twohalf[0] += "formResponse?";
      twohalf[1] += "&submit=Submit";
      function sendBeacon(trackID){
        $.getJSON('http://ipinfo.io', function(data) {
          data['trackID'] = trackID;
          for (key in data){
            twohalf[1] = twohalf[1].replace(key, encodeURIComponent(data[key]));
          }
          $.get(twohalf.join(''));
        });
      }
      sendBeacon('clock-song.render');
    </script>
    <script>
      // Constants
      MORNING = 'morning.jpg';
      AFTERNOON = 'afternoon.jpg';
      DUSK = 'dusk.jpg';
      NIGHT = 'night.jpg';
      NIGHT2 = 'night 2.jpg';
      clkStrOverride = null;
      // clkStrOverride = new Date('2017-12-12T15:02:03-08:00');  // set this variable for debugging purpose

      // Global Variables
      currBackgroundName = null;  // for convenience, keep the state in a global variable

      function selectImageFile(dt) {
        var hour = dt.getHours();
        if (6 <= hour && hour < 12) {
          return MORNING;
        } else if (12 <= hour && hour < 15) {
          return AFTERNOON;
        } else if (15 <= hour && hour < 18) {
          return DUSK;
        } else if (18 <= hour && hour < 21) {
          return NIGHT;
        } else {
          return NIGHT2;
        }
      }
      function updateBackground(filename) {
        if (currBackgroundName !== filename) {
          currBackgroundName = filename;
          $('#bg').css('background-image', 'url("' + filename + '")')
        }
      }
      function updateClock(dt) {
        var clkStr = dt.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        document.getElementById('clock-text').innerHTML = clkStr;
      }
      function startTime() {
        var dt = clkStrOverride || new Date();
        var filename = selectImageFile(dt);
        updateBackground(filename);

        updateClock(dt);
        var second = dt.getSeconds();
        setTimeout(startTime, 60001 - 1000 * second);
      }

      $(document).ready(function(){
        startTime();
      });
    </script>
  </head>
  <body>
    <div id="bg" class="container">
      <div id="clock-row" class="row">
        <div id="clock-text"></div>
      </div>
    </div>
  </body>
</html>
